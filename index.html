<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trá»£ LÃ½ TÃ i ChÃ­nh Cá»§a TÃ´i</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* 1. Äá»‹nh nghÄ©a bá»™ mÃ u SÃ¡ng (Máº·c Ä‘á»‹nh) */
        :root {
            --bg-color: #f8f9fa;
            --text-color: #212529;
            --card-bg: #ffffff;
            --input-bg: #ffffff;
            --input-border: #ced4da;
            --list-item-bg: #ffffff;
            --placeholder-color: #6c757d; 
            --muted-color: #6c757d; /* MÃ u cho chá»¯ má» */
        }

        /* 2. Äá»‹nh nghÄ©a bá»™ mÃ u Tá»‘i (Khi kÃ­ch hoáº¡t) */
        [data-theme="dark"] {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --card-bg: #1e1e1e;
            --input-bg: #2d2d2d;
            --input-border: #444;
            --list-item-bg: #1e1e1e;
            --placeholder-color: #aaa; 
            --muted-color: #adb5bd; /* Sá»­a lá»—i: Chá»¯ má» sÃ¡ng hÆ¡n Ä‘á»ƒ dá»… Ä‘á»c trÃªn ná»n tá»‘i */
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }
        .card {
            background-color: var(--card-bg);
            color: var(--text-color);
        }
        .list-group-item {
            background-color: var(--list-item-bg);
            color: var(--text-color);
            border-color: var(--input-border);
        }
        .form-control, .form-select {
            background-color: var(--input-bg);
            color: var(--text-color);
            border-color: var(--input-border);
        }
        .form-control:focus, .form-select:focus {
            background-color: var(--input-bg);
            color: var(--text-color);
        }
        .form-control::placeholder {
            color: var(--placeholder-color);
            opacity: 1;
        }
        
        /* Ãp dá»¥ng biáº¿n mÃ u muted má»›i sá»­a */
        .text-muted {
            color: var(--muted-color) !important;
        }

        .total-box { background: #0d6efd; color: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; }

        .theme-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            z-index: 1000;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
        }
        
        [data-theme="dark"] ::-webkit-calendar-picker-indicator {
            filter: invert(1);
        }
    </style>
</head>
<body>

<div class="container py-4" style="max-width: 600px;">
    <button id="themeToggle" class="btn btn-warning theme-btn">ğŸŒ™</button>

    <div class="text-center total-box">
        <h3>Tá»•ng Chi TiÃªu</h3>
        <h1 id="totalAmount">0 â‚«</h1>
    </div>

    <div class="card p-3 mb-4">
        <h5 class="mb-3">â• ThÃªm khoáº£n chi má»›i</h5>
        <form id="expenseForm">
            <div class="mb-3">
                <label class="form-label small text-muted">NgÃ y chi tiÃªu</label>
                <input type="date" class="form-control" id="date" required>
            </div>
            
            <div class="mb-3">
                <input type="text" class="form-control" id="desc" placeholder="Mua gÃ¬ Ä‘Ã³? (Vd: CÃ  phÃª)" required>
            </div>
            <div class="mb-3">
                <input type="number" class="form-control" id="amount" placeholder="Háº¿t bao nhiÃªu? (Vd: 30000)" required>
            </div>
            <div class="mb-3">
                <select class="form-select" id="category">
  			 <option value="AEON">ğŸ›ï¸ AEON</option>
   			 <option value="Shoppee">ğŸ“¦ Shoppee</option>
   			 <option value="Shopping">ğŸ‘— Shopping (KhÃ¡c)</option>
  			 <option value="Ä‚n uá»‘ng">ğŸ” Ä‚n uá»‘ng</option>
   			 <option value="Unknown Fee">â“ Unknown Fee</option>
		</select>
            </div>
            <button type="submit" class="btn btn-primary w-100">LÆ°u láº¡i</button>
        </form>
    </div>

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="m-0">ğŸ“ Lá»‹ch sá»­ chi tiÃªu</h5>
        <select class="form-select form-select-sm w-auto" id="filterCategory">
            <option value="all">Táº¥t cáº£</option>
            <option value="AEON">ğŸ›ï¸ AEON</option>
            <option value="Shoppee">ğŸ“¦ Shoppee</option>
            <option value="Shopping">ğŸ‘— Shopping (KhÃ¡c)</option>
            <option value="Ä‚n uá»‘ng">ğŸ” Ä‚n uá»‘ng</option>
            <option value="Unknown Fee">â“ Unknown Fee</option>
        </select>
    </div>

    <ul class="list-group" id="expenseList">
        </ul>
</div>

<script>
    const form = document.getElementById('expenseForm');
    const list = document.getElementById('expenseList');
    const totalDisplay = document.getElementById('totalAmount');
    const dateInput = document.getElementById('date');
    const filterSelect = document.getElementById('filterCategory'); // Láº¥y Ã´ lá»c

    dateInput.valueAsDate = new Date();

    let expenses = JSON.parse(localStorage.getItem('myExpenses')) || [];

    function formatDate(dateString) {
        if (!dateString) return '';
        const [year, month, day] = dateString.split('-');
        return `${day}/${month}/${year}`;
    }

    function renderExpenses() {
        list.innerHTML = '';
        let total = 0;
        
        // Sáº¯p xáº¿p
        expenses.sort((a, b) => new Date(b.date) - new Date(a.date));

        // 1. TÃ­nh tá»•ng tiá»n (LuÃ´n tÃ­nh trÃªn Táº¤T Cáº¢, hay chá»‰ tÃ­nh trÃªn cÃ¡i Ä‘ang lá»c? 
        // ThÆ°á»ng thÃ¬ user muá»‘n xem tá»•ng cá»§a cÃ¡i Ä‘ang lá»c. TÃ´i sáº½ tÃ­nh tá»•ng dá»±a trÃªn bá»™ lá»c nhÃ©)
        
        const currentFilter = filterSelect.value;
        
        // Lá»c danh sÃ¡ch trÆ°á»›c khi hiá»ƒn thá»‹
        const filteredExpenses = expenses.filter(item => {
            if (currentFilter === 'all') return true;
            return item.category === currentFilter;
        });

        filteredExpenses.forEach((item) => {
            total += parseInt(item.amount);
            const li = document.createElement('li');
            li.className = 'list-group-item d-flex justify-content-between align-items-center';
            li.innerHTML = `
                <div>
                    <strong>${item.desc}</strong> <br>
                    <small class="text-muted">
                        ğŸ“… ${formatDate(item.date)} | ${item.category}
                    </small>
                </div>
                <div>
                    <span class="badge bg-secondary rounded-pill">${parseInt(item.amount).toLocaleString()} â‚«</span>
                    <button class="btn btn-sm btn-outline-danger ms-2" onclick="deleteItem(${item.id})">Ã—</button>
                </div>
            `;
            list.appendChild(li);
        });
        
        // Hiá»ƒn thá»‹ tá»•ng tiá»n cá»§a danh sÃ¡ch Ä‘ang xem
        totalDisplay.innerText = total.toLocaleString() + ' â‚«';
    }

    // Sá»± kiá»‡n khi thay Ä‘á»•i bá»™ lá»c
    filterSelect.addEventListener('change', () => {
        renderExpenses();
    });

// --- âš ï¸ GIá»® NGUYÃŠN LINK Cá»¦A Báº N ---
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzuLpPzdOXpsS7PlcKHjIgnFBRWZZBdJS8s119lgkKUBT_q-GroZt8SQVGGENukEeceQw/exec"; 

    form.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const date = document.getElementById('date').value;
        const desc = document.getElementById('desc').value;
        const inputAmount = document.getElementById('amount').value; // Sá»‘ nháº­p vÃ o (vd: 49)
        const category = document.getElementById('category').value;
        
        // --- LOGIC Má»šI: NhÃ¢n 1000 ngay táº¡i Ä‘Ã¢y ---
        const finalAmount = inputAmount * 1000; 

        // Hiá»‡u á»©ng nÃºt báº¥m
        const btn = form.querySelector('button[type="submit"]');
        const originalText = btn.innerText;
        btn.innerText = "â³ Äang lÆ°u...";
        btn.disabled = true;

        // Gá»­i dá»¯ liá»‡u ÄÃƒ NHÃ‚N lÃªn Google Sheet
        fetch(SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ date, desc, amount: finalAmount, category }) // Gá»­i sá»‘ 49000
        })
        .then(() => {
            // LÆ°u vÃ o giao diá»‡n sá»‘ 49000
            expenses.push({ id: Date.now(), date, desc, amount: finalAmount, category });
            localStorage.setItem('myExpenses', JSON.stringify(expenses));
            renderExpenses();
            
            form.reset();
            dateInput.valueAsDate = new Date();
            
            alert("âœ… ÄÃ£ lÆ°u: " + parseInt(finalAmount).toLocaleString() + " Ä‘");
        })
        .catch(error => {
            alert("âŒ Lá»—i káº¿t ná»‘i: " + error);
        })
        .finally(() => {
            btn.innerText = originalText;
            btn.disabled = false;
        });
    });

    // HÃ m xÃ³a item dá»±a trÃªn ID (An toÃ n hÆ¡n xÃ³a theo index)
    window.deleteItem = (id) => {
        expenses = expenses.filter(item => item.id !== id);
        localStorage.setItem('myExpenses', JSON.stringify(expenses));
        renderExpenses();
    };

    // --- LOGIC GIAO DIá»†N ---
    const themeBtn = document.getElementById('themeToggle');
    const html = document.documentElement;
    const savedTheme = localStorage.getItem('theme');
    
    if (savedTheme === 'dark') {
        html.setAttribute('data-theme', 'dark');
        themeBtn.innerText = 'â˜€ï¸';
        themeBtn.classList.replace('btn-warning', 'btn-light');
    }

    themeBtn.addEventListener('click', () => {
        if (html.getAttribute('data-theme') === 'dark') {
            html.removeAttribute('data-theme');
            localStorage.setItem('theme', 'light');
            themeBtn.innerText = 'ğŸŒ™';
            themeBtn.classList.replace('btn-light', 'btn-warning');
        } else {
            html.setAttribute('data-theme', 'dark');
            localStorage.setItem('theme', 'dark');
            themeBtn.innerText = 'â˜€ï¸';
            themeBtn.classList.replace('btn-warning', 'btn-light');
        }
    });

    renderExpenses();
</script>

</body>

</html>
